var url=jQuery("#ypdiframe").attr("src");function awaitApproval(){try{document.domain==jQuery("#ypiframe").contents().get(0).location.host&&(clearInterval(awaitApproval),jQuery("#ypiframe").contents().find("html").html(""),window.top.location.href=jQuery("#ypiframe").contents().get(0).location.href),console.log(Date.now()+"DATE")}catch(e){setTimeout(function(){console.log(Date.now()+"DATE ERR"),awaitApproval()},1e3)}}function prepareFrame(){jQuery("#ypiframe").attr("src",url),awaitApproval()}function loadjQuery(){wp_enqueue_script("jQuery"),console.log("Load jQuery")}"undefined"==typeof jQuery&&loadjQuery(),jQuery(document).ready(function(e){var o,a="";function r(r){e.ajax({type:"POST",url:"https://webservice.yourpay.dk/httpd.php?json=1",crossDomain:!0,data:{function:"TransactionTokenGenerate"},dataType:"json",success:function(t,n,y){(function a(r){e.ajax({type:"POST",url:"https://webservice.yourpay.dk/httpd.php?json=1",crossDomain:!0,data:{function:"TransactionTokenLookup",token:r},dataType:"json",success:function(t,n,y){var i=e(".yourpay_form.overflow input[name='accepturl']").val()+"&";e.each(t,function(e,o){i+=e+"="+o+"&"}),i.trim(i,"&"),t.hasOwnProperty("TransID")?window.location.replace(i):o=setTimeout(function(){a(r)},5e3)},error:function(e,o,a){console.log("POST failed.")}})})(a=t.Token),e("body").prepend("<div class='yourpayoverlay'></div>").addClass("cover"),e(".yourpayoverlay").addClass("cover"),e(".yourpayoverlay").before("<div class='yourpay iframeview'></div>"),e(".yourpay.iframeview").before("<div class='yourpay closebutton'><img src='"+r+"'></div>"),e(".yourpay.iframeview").append("<iframe src='https://payments.yourpay.se/betalingsvindue_cardtype.php?paymenttoken="+a+"&"+e(".yourpay_form").serialize()+"'>"),e(".yourpay.closebutton").css("margin-left",e(".yourpay.iframeview").width()/2-24),e(".yourpay.closebutton").click(function(){e(".yourpay.closebutton").remove(),e(".yourpay.iframeview").remove(),e(".yourpayoverlay.cover").remove(),clearTimeout(o)})},error:function(e,o,a){alert("POST failed.")}})}e(window).resize(function(){e(".yourpay.closebutton").css("margin-left",e(".yourpay.iframeview").width()/2-24)}),r(yourpay_images.close_48),e(".startpayment").click(function(){r(yourpay_images.close_48)}),jQuery(".yourpayclose").click(function(){jQuery(".yourpay.outer").css("display","none"),jQuery(".yourpay.grayedout").css("display","none")})});